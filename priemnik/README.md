# Счетчик iPhone по BLE для macOS

Это простое приложение с графическим интерфейсом для macOS, которое сканирует эфир в поиске iPhone по Bluetooth Low Energy (BLE).

## Что оно делает?

-   Сканирует BLE-устройства.
-   Фильтрует устройства, в имени которых есть "iPhone".
-   Считает, сколько из них находится в заданном радиусе (по умолчанию 1 метр).
-   Показывает таблицу найденных айфонов с их именем, ID, RSSI, расстоянием и временем с последнего обнаружения.
-   Отправляет события о входе/выходе устройства из радиуса на локальный API-сервер (если он поднят).
-   Пишет подробный лог в файл `bt_debug.log`.

## Требования

-   **macOS**: Скрипт использует нативные фреймворки CoreBluetooth через PyObjC, поэтому работает только на маке.
-   **Python 3**: Нужен Python 3. На чем-то другом не тестилось и, скорее всего, не заведется.

## Как запустить?

1.  **Клонируй репозиторий (если еще не сделал)**
    ```bash
    git clone <адрес-репозитория>
    cd priemnik
    ```

2.  **Создай и активируй виртуальное окружение**
    Это хорошая практика, чтобы не засирать системный Python.

    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

3.  **Установи зависимости**
    Все необходимое перечислено в `requirements.txt`.

    ```bash
    pip install -r requirements.txt
    ```

4.  **Запусти скрипт**
    ```bash
    python3 ble_iphone_counter_qt.py
    ```

    После запуска появится окно приложения, которое начнет сканирование.

## Конфигурация

Скрипт можно настроить через переменные окружения. Вот основные:

-   `RADIUS_M`: Радиус в метрах для подсчета устройств (по умолчанию: `1.0`).
-   `TTL_SEC`: Сколько секунд устройство считается "живым" без обновлений (по умолчанию: `8`).
-   `NAME_SUBSTR`: Подстрока для поиска в имени устройства (по умолчанию: `iphone`, регистр не важен).
-   `API_BASE_URL`: Адрес API сервера для отправки событий (по умолчанию: `http://192.168.195.57:8000`).
-   `ID_BUS`: ID "автобуса", который отправляется с каждым событием (по умолчанию: `aaa`).

Пример запуска с кастомными параметрами:
```bash
RADIUS_M="2.5" TTL_SEC="10" python3 ble_iphone_counter_qt.py
```
